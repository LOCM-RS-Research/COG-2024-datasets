# Adaptivity of Card Recommendation Systems in Legends of Code and Magic
Code and datasets for our papers titled "Adaptivity of Card Recommendation Systems in Legends of Code and Magic"

## Reproduction of the results

The `./logs` folder contains the logs generated by the game simulations.
It also contains the original and modified definitions of the cards (cardlists).
The modifications are described below.

`./LegendsOfCodeAndMagic-1.2.jar` is a Java 19 build of the modified game.

### Installation Requirements

  * R 4.4 with the following packages: xtable, rpart.plot, moments, jsonlite, parallel, GA, adana, ggplot2, dplyr, tidyr, caret
  * OpenJDK 19

### E1-E4

  * Generate train and test decks: Open `./generate_test_deck_data.R` in a REPL, uncomment the lines generating and writing `./logs/train_decks.txt`, `./logs/test_decks.txt` and `./opponents.txt`.
  * Generate logs for these decks: Continuously pick a random line from the train/test txt as p1 deck and a random line from the opponents txt as p2 deck and play them using the LOCM jar. Append or replace the LOCM JSON output to the njson file in `./logs`. Stop when sufficient games have been played. We distributed this task onto multiple machines using Bash/CMD scripts.
  * Use `./generate_test_deck_data.R` to precompute CSV summary statistics from the njson logs.
  * Plot figures and print tables based on the logs and summaries using `./evaluate_scenarios.R`.

### E5-E8

  * Modify the parameters of the Genetic Algorithm at the end of `./run_ga.R` and execute it. This script was written to run on a multi-core machine, it will take 1-3 days to complete depending on the parameters chosen. njson logs and CSV summaries will be written to the logs folder.
  * Plot figures and print tables based on the logs and summaries using `./evaluate_ga.R`.

## Modifications

### LOCM

The original source code can be found at https://github.com/acatai/Strategy-Card-Game-AI-Competition

The patch `./0001-Modify-referee-1.2-java-for-thesis.patch` was applied to commit 7aaec88d2c19e24f0f10f24bb6d6cf141e69f46e to modify the game, allowing to pass decks and card data via parameters (thus changing the rules of the draft phase) and adding a random agent.

### E2: Cards added

| `id` | `type`     | `cost` | `attack` | `defense` | `abilities` | `playerHP` | `enemyHP` | `cardDraw` |
|------|------------|--------|----------|-----------|-------------|------------|-----------|------------|
| 161  | itemRed    | 3      | 0        | -6        | ------      | 0          | -2        | 0          |
| 162  | itemRed    | 2      | -1       | -1        | BCDGLW      | +1         | -1        | 1          |
| 163  | itemRed    | 4      | -5       | -5        | BCDGLW      | 0          | -1        | 1          |
| 164  | itemRed    | 2      | -4       | -3        | BCDGLW      | 0          | 0         | 1          |
| 165  | itemGreen  | 3      | 1        | 4         | ---G--      | 0          | 0         | 1          |
| 166  | itemGreen  | 3      | 6        | 3         | -C----      | 0          | 0         | 0          |
| 167  | itemGreen  | 3      | 2        | 6         | ---G--      | 0          | 0         | 0          |
| 168  | itemGreen  | 4      | 6        | 4         | BC----      | +3         | 0         | 0          |
| 169  | itemGreen  | 4      | 3        | 3         | -----W      | +2         | 0         | 1          |
| 170  | itemBlue   | 3      | 0        | -2        | ------      | +2         | -2        | 1          |
| 171  | itemBlue   | 2      | 0        | -2        | ------      | 0          | -3        | 0          |
| 172  | creature   | 4      | 5        | 5         | -C----      | 0          | 0         | 0          |
| 173  | creature   | 5      | 2        | 9         | ---G--      | 0          | 0         | 1          |
| 174  | creature   | 4      | 7        | 1         | -C----      | +1         | 0         | 0          |
| 175  | creature   | 1      | 1        | 2         | -C-G--      | 0          | 0         | 0          |
| 176  | creature   | 2      | 3        | 3         | B-----      | 0          | 0         | 1          |

### E3: Cards modified

| `id`  | `type` | `cost`       | `attack`     | `defense`    | `abilities` | `playerHP` | `enemyHP` | `cardDraw` |
|-------|--------|--------------|--------------|--------------|-------------|------------|-----------|------------|
| 18    |        | 4→5          | 7→6          | 4→3          |             |            |           |            |
| 123   |        | 2→3          | 4→1          | 0→4          | +G          |            |           |            |
| 124   |        |              | 2→1          | 1→0          |             |            |           |            |
| 69    |        | 3→4          |              | 4→1          |             |            |           |            |
| 57    |        | 4→3          | 1→3          |              | +G          |            |           |            |
| 140   |        | 2→1          | 0→2          |              |             |            |           | 0→1        |
| 110   |        | 5→3          | 0→3          |              |             | 0→1        |           | 0→1        |
| 108   |        | 5→2          | 2→4          | 6→2          | +C -G       |            | 0→-1      | 0→1        |
| 7     |        |              | 2→2          | 2→4          | +G -W       |            |           |            |
| 127   |        | 3→2          |              |              |             |            |           | 0→1        |
| 83    |        |              |              |              | -C          |            |           |            |
| 21    |        |              | 6→2          |              |             |            |           |            |